package com.klaus.iv.stockspider.utils;

import com.klaus.iv.commonbase.util.CommonConstants;
import com.klaus.iv.stockspider.constants.NetEaseApi;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.stream.Collectors;

import static com.klaus.iv.stockspider.constants.NetEaseApi.REDIS_STOCK_PREFIX;
import static java.lang.Math.max;
import static java.lang.Math.min;



@Slf4j
public class StockComputeUtil {
    private static final Double EMPTY_DATA_DOUBLE = Double.valueOf("0");

    private StockComputeUtil() {
    }

    public static Double format(Double data) {
        BigDecimal ori = new BigDecimal(data);
        return ori.setScale(2, BigDecimal.ROUND_HALF_UP).doubleValue();
    }

    public static LocalDateTime stringToDate(String data) {
        DateTimeFormatter df = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        return LocalDateTime.parse(data,df);
    }

    /**
     * 获取平均值
     * @param datas
     * @param days
     * @return
     */
    public static Double daysLine(List<Double> datas, int days) {
        try {
            return format(datas.stream().limit(days).mapToDouble(node -> node.doubleValue()).average().getAsDouble());
        } catch (Exception e) {
            log.info(" data error :{}, datas:{} days :{}", e, datas, days);
        }
        return EMPTY_DATA_DOUBLE;
    }


    /**
     * 获取最高连续涨幅
     * @param maxDataList
     * @return
     */
    public static Double findGreatestSumOfSubArray(List<Double> maxDataList) {
        try {
            if(maxDataList == null || maxDataList.isEmpty()) {
                return 0.0d;
            }
            Double max_sum = maxDataList.get(0);
            Double max = maxDataList.get(0);
            for (int i = 1; i < maxDataList.size(); i++) {
                max_sum = max(max_sum + maxDataList.get(i), maxDataList.get(i));
                max = max(max_sum, max);
            }
            return format(max);
        } catch (Exception e) {
            log.info("data error , data is:{}, error is:{}", maxDataList, e);
        }
        return EMPTY_DATA_DOUBLE;
    }

    public static int maxSubArray4(int[] a) {
        int start = 0, sum=0,max = Integer.MIN_VALUE;
        for(int i=0; i<a.length; i++){
            if(sum < 0){
                sum = a[i];
                start = i;
            }else{
                sum += a[i];
            }
            if(sum > max){
                max = sum;
//                begin = start;
//                end = i;
            }
        }
        return max;
    }


    /**
     * 获取最低连续跌幅
     * @param minDataList
     * @return
     */
    public static Double findMinestSumOfSubArray(List<Double> minDataList) {
        try {
            if(minDataList == null || minDataList.isEmpty()) {
                return 0.0;
            }
            Double min_sum = minDataList.get(0);
            Double min = minDataList.get(0);
            for (int i = 1; i < minDataList.size(); i++) {
                min_sum = min(min_sum + minDataList.get(i), minDataList.get(i));
                min = min(min_sum, min);
            }
            return format(min);
        } catch (Exception e) {
            log.info("data error , data is:{}, error is: {}", minDataList, e);
        }
        return EMPTY_DATA_DOUBLE;
    }

    public static List<List> findRateMaps(List<ArrayList> datas) {
        List<List> rateLists = new ArrayList<>();
        try {
            double growthRate = 0d;
            int i = datas.size()-1, j=1;
            for(;i>=0;i--, j++) {
                ArrayList data = datas.get(j-1);
                double rate = (double)data.get(6);
                growthRate +=rate;
                //log.debug("data is :{}", datas.get(i));
                rateLists.add(Arrays.asList(String.format("%sDayRate", j), format(new Double(growthRate))));
            }
        } catch (Exception e) {
            log.error("error is:{}, datas is:{}", e, datas);
        }
        return rateLists;
    }



    public static String getRegion(String stockCode) {
        if (StringUtils.isEmpty(stockCode)) {
            return null;
        }
        if (stockCode.startsWith("6")) {
            return NetEaseApi.Region.SH.getValue();
        }
        return NetEaseApi.Region.SZ.getValue();
    }



    public static String getStockRedisDayKey(String stockCode, String api, CommonConstants.DataPattern pattern) {

        return String.format("%s:%s:%s:%s", REDIS_STOCK_PREFIX, stockCode, api, LocalDateTime.now().format(DateTimeFormatter.ofPattern(pattern.getValue())));
    }

    public static String getStockRedisDayKey(String stockCode, String api, String dateCode) {

        return String.format("%s:%s:%s:%s", REDIS_STOCK_PREFIX, stockCode, api, dateCode);
    }


    public static String getStockRedisRealtimeKey(String stockCode, String api, CommonConstants.DataPattern dayPattern) {

        LocalDateTime localDateTime = LocalDateTime.now();
        return String.format("%s:%s:%s:%s", REDIS_STOCK_PREFIX, stockCode, api, localDateTime.format(DateTimeFormatter.ofPattern(dayPattern.getValue())));
    }

    public static String getStockRedisYearKey(String stockCode, String api, CommonConstants.DataPattern yearPattern) {

        LocalDateTime localDateTime = LocalDateTime.now();
        return String.format("%s:%s:%s:%s", REDIS_STOCK_PREFIX, stockCode, api, localDateTime.format(DateTimeFormatter.ofPattern(yearPattern.getValue())));
    }

    public static List<HashMap> handleHistoryForDaysData(HashMap data) {
        /**
         *
         *   小时分钟时间、价格、均价、成交量
         *  [0930, 15.87, 15.87, 259200]
         *   symbol=600895, data=[
         *      {
         *          count=242,
         *          data=[[0930, 16.24, 16.24, 58400], [0931, 16.26, 16.25, 564800], [0932, 16.27, 16.257, 140456], [0933, 16.28, 16.263, 156073], [0934, 16.28, 16.266, 147847], [0935, 16.27, 16.267, 142794], [0936, 16.33, 16.276, 232761], [0937, 16.4, 16.291, 145800], [0938, 16.41, 16.304, 280195], [0939, 16.4, 16.314, 206238], [0940, 16.38, 16.32, 155362], [0941, 16.37, 16.324, 58780], [0942, 16.35, 16.326, 71063], [0943, 16.34, 16.327, 84557], [0944, 16.34, 16.328, 40134], [0945, 16.36, 16.33, 82097], [0946, 16.39, 16.334, 46165], [0947, 16.4, 16.337, 101512], [0948, 16.39, 16.34, 82907], [0949, 16.4, 16.343, 100918], [0950, 16.39, 16.345, 85500], [0951, 16.39, 16.347, 67482], [0952, 16.37, 16.348, 68181], [0953, 16.37, 16.349, 41213], [0954, 16.37, 16.35, 43540], [0955, 16.37, 16.351, 70268], [0956, 16.38, 16.352, 36279], [0957, 16.38, 16.353, 25108], [0958, 16.38, 16.354, 53626], [0959, 16.37, 16.354, 50426], [1000, 16.37, 16.355, 60068], [1001, 16.37, 16.355, 68300], [1002, 16.36, 16.355, 50400], [1003, 16.37, 16.356, 59085], [1004, 16.37, 16.356, 54031], [1005, 16.34, 16.356, 50843], [1006, 16.32, 16.355, 106640], [1007, 16.32, 16.354, 49106], [1008, 16.33, 16.353, 40588], [1009, 16.31, 16.352, 68825], [1010, 16.32, 16.351, 45295], [1011, 16.31, 16.35, 27064], [1012, 16.31, 16.35, 175142], [1013, 16.31, 16.349, 53605], [1014, 16.3, 16.348, 20300], [1015, 16.33, 16.347, 67926], [1016, 16.37, 16.348, 104946], [1017, 16.36, 16.348, 63400], [1018, 16.38, 16.349, 46181], [1019, 16.38, 16.349, 42741], [1020, 16.37, 16.35, 30200], [1021, 16.37, 16.35, 46935], [1022, 16.37, 16.35, 40500], [1023, 16.36, 16.351, 13877], [1024, 16.36, 16.351, 37413], [1025, 16.37, 16.351, 20033], [1026, 16.37, 16.351, 19600], [1027, 16.37, 16.352, 49700], [1028, 16.37, 16.352, 23027], [1029, 16.37, 16.352, 40906], [1030, 16.36, 16.352, 54984], [1031, 16.38, 16.353, 17559], [1032, 16.4, 16.354, 187596], [1033, 16.42, 16.355, 149400], [1034, 16.42, 16.356, 81700], [1035, 16.43, 16.357, 103750], [1036, 16.44, 16.358, 60272], [1037, 16.43, 16.359, 137478], [1038, 16.43, 16.36, 118100], [1039, 16.43, 16.361, 61400], [1040, 16.42, 16.362, 51600], [1041, 16.42, 16.363, 17100], [1042, 16.42, 16.364, 29157], [1043, 16.39, 16.364, 34143], [1044, 16.39, 16.364, 35625], [1045, 16.41, 16.365, 38535], [1046, 16.41, 16.365, 15100], [1047, 16.39, 16.366, 22507], [1048, 16.41, 16.366, 22449], [1049, 16.4, 16.367, 7212], [1050, 16.43, 16.368, 83500], [1051, 16.43, 16.368, 99377], [1052, 16.44, 16.369, 144003], [1053, 16.45, 16.37, 37100], [1054, 16.43, 16.371, 27900], [1055, 16.43, 16.372, 20597], [1056, 16.42, 16.372, 81727], [1057, 16.42, 16.373, 84700], [1058, 16.45, 16.373, 64812], [1059, 16.41, 16.374, 50147], [1100, 16.44, 16.375, 92030], [1101, 16.42, 16.375, 39800], [1102, 16.42, 16.376, 30500], [1103, 16.44, 16.376, 28500], [1104, 16.42, 16.377, 82300], [1105, 16.42, 16.377, 34900], [1106, 16.42, 16.378, 47209], [1107, 16.44, 16.378, 34846], [1108, 16.45, 16.379, 39870], [1109, 16.45, 16.38, 110886], [1110, 16.51, 16.381, 506978], [1111, 16.5, 16.382, 152900], [1112, 16.5, 16.383, 55800], [1113, 16.49, 16.384, 61000], [1114, 16.49, 16.385, 74774], [1115, 16.55, 16.387, 215700], [1116, 16.52, 16.388, 106400], [1117, 16.51, 16.389, 26700], [1118, 16.51, 16.39, 30100], [1119, 16.51, 16.391, 23536], [1120, 16.51, 16.393, 22100], [1121, 16.5, 16.393, 94864], [1122, 16.47, 16.394, 38917], [1123, 16.46, 16.395, 50409], [1124, 16.46, 16.395, 16001], [1125, 16.44, 16.396, 29299], [1126, 16.42, 16.396, 20400], [1127, 16.45, 16.396, 25900], [1128, 16.42, 16.397, 6900], [1129, 16.43, 16.397, 7417], [1130, 16.43, 16.397, 0], [1300, 16.46, 16.398, 62929], [1301, 16.47, 16.398, 14000], [1302, 16.46, 16.399, 6260], [1303, 16.45, 16.399, 21252], [1304, 16.46, 16.4, 7164], [1305, 16.45, 16.4, 29200], [1306, 16.48, 16.401, 15761], [1307, 16.47, 16.401, 17217], [1308, 16.45, 16.402, 25022], [1309, 16.47, 16.402, 24800], [1310, 16.44, 16.402, 35300], [1311, 16.43, 16.403, 24508], [1312, 16.44, 16.403, 38000], [1313, 16.44, 16.403, 18300], [1314, 16.44, 16.403, 28300], [1315, 16.44, 16.404, 35509], [1316, 16.43, 16.404, 10821], [1317, 16.43, 16.404, 34808], [1318, 16.44, 16.404, 12238], [1319, 16.45, 16.405, 32681], [1320, 16.43, 16.405, 10823], [1321, 16.44, 16.405, 19300], [1322, 16.43, 16.405, 45900], [1323, 16.43, 16.405, 3611], [1324, 16.42, 16.405, 41684], [1325, 16.41, 16.406, 29743], [1326, 16.42, 16.406, 72941], [1327, 16.41, 16.406, 61600], [1328, 16.39, 16.406, 99442], [1329, 16.38, 16.405, 9727], [1330, 16.41, 16.405, 128307], [1331, 16.43, 16.406, 41600], [1332, 16.43, 16.406, 42400], [1333, 16.43, 16.406, 8997], [1334, 16.43, 16.406, 24809], [1335, 16.42, 16.406, 63143], [1336, 16.43, 16.406, 17547], [1337, 16.42, 16.406, 30367], [1338, 16.41, 16.406, 34837], [1339, 16.38, 16.406, 83701], [1340, 16.39, 16.406, 27500], [1341, 16.38, 16.406, 54500], [1342, 16.38, 16.406, 112100], [1343, 16.39, 16.406, 21900], [1344, 16.37, 16.405, 19600], [1345, 16.37, 16.405, 60900], [1346, 16.36, 16.405, 44706], [1347, 16.36, 16.405, 17477], [1348, 16.37, 16.405, 43200], [1349, 16.38, 16.404, 33038], [1350, 16.36, 16.404, 27490], [1351, 16.37, 16.404, 42700], [1352, 16.38, 16.404, 44202], [1353, 16.38, 16.404, 119007], [1354, 16.37, 16.403, 39636], [1355, 16.37, 16.403, 49663], [1356, 16.36, 16.403, 16100], [1357, 16.37, 16.403, 23724], [1358, 16.35, 16.403, 27500], [1359, 16.36, 16.402, 15672], [1400, 16.36, 16.402, 20990], [1401, 16.34, 16.402, 82200], [1402, 16.31, 16.401, 116100], [1403, 16.31, 16.401, 53348], [1404, 16.33, 16.4, 58900], [1405, 16.32, 16.4, 45859], [1406, 16.34, 16.4, 27543], [1407, 16.35, 16.399, 39400], [1408, 16.35, 16.399, 42900], [1409, 16.34, 16.399, 31600], [1410, 16.34, 16.398, 26734], [1411, 16.35, 16.398, 48000], [1412, 16.35, 16.398, 56500], [1413, 16.35, 16.398, 69708], [1414, 16.38, 16.398, 77487], [1415, 16.36, 16.397, 84835], [1416, 16.39, 16.397, 24300], [1417, 16.38, 16.397, 13222], [1418, 16.37, 16.397, 26500], [1419, 16.36, 16.397, 14600], [1420, 16.35, 16.397, 51578], [1421, 16.34, 16.397, 42900], [1422, 16.35, 16.396, 13000], [1423, 16.36, 16.396, 55506], [1424, 16.37, 16.396, 49700], [1425, 16.38, 16.396, 21022], [1426, 16.38, 16.396, 13900], [1427, 16.37, 16.396, 25713], [1428, 16.36, 16.396, 41165], [1429, 16.37, 16.395, 11671], [1430, 16.38, 16.395, 29478], [1431, 16.37, 16.395, 27569], [1432, 16.36, 16.395, 31571], [1433, 16.35, 16.395, 27522], [1434, 16.35, 16.395, 21916], [1435, 16.36, 16.394, 35702], [1436, 16.35, 16.394, 38900], [1437, 16.36, 16.394, 52732], [1438, 16.36, 16.394, 45100], [1439, 16.35, 16.394, 54970], [1440, 16.37, 16.394, 102427], [1441, 16.37, 16.394, 77131], [1442, 16.38, 16.393, 34113], [1443, 16.38, 16.393, 96875], [1444, 16.4, 16.393, 71000], [1445, 16.4, 16.393, 52228], [1446, 16.39, 16.393, 75776], [1447, 16.4, 16.393, 34650], [1448, 16.4, 16.394, 98009], [1449, 16.39, 16.394, 68185], [1450, 16.41, 16.394, 245701], [1451, 16.45, 16.394, 158200], [1452, 16.46, 16.394, 244985], [1453, 16.47, 16.394, 195700], [1454, 16.49, 16.395, 356361], [1455, 16.47, 16.395, 344119], [1456, 16.45, 16.395, 219581], [1457, 16.47, 16.396, 200], [1458, 16.47, 16.396, 0], [1459, 16.47, 16.396, 0], [1500, 16.19, 16.395, 2792823]],
         *          yestclose=16.01,
         *          lastVolume=18189194,
         *          date=20190827
         *      },
         *      {count=242, data=[[0930, 15.87, 15.87, 259200], [0931, 15.84, 15.855, 891600], [0932, 15.83, 15.847, 260900], [0933, 15.85, 15.848, 191300], [0934, 15.9, 15.858, 392800], [0935, 16.05, 15.89, 320600], [0936, 15.97, 15.901, 313500], [0937, 16.03, 15.918, 181400], [0938, 16.01, 15.928, 110400], [0939, 16.03, 15.938, 123000], [0940, 16.01, 15.945, 112900], [0941, 16.0, 15.949, 108600], [0942, 15.99, 15.952, 137800], [0943, 15.99, 15.955, 102900], [0944, 16.0, 15.958, 56200], [0945, 15.97, 15.959, 205900], [0946, 15.94, 15.958, 97500], [0947, 15.94, 15.957, 105200], [0948, 15.97, 15.957, 47400], [0949, 15.97, 15.958, 54400], [0950, 15.97, 15.959, 103700], [0951, 15.98, 15.96, 106500], [0952, 16.01, 15.962, 72800], [0953, 15.99, 15.963, 50600], [0954, 15.99, 15.964, 38700], [0955, 15.98, 15.965, 57700], [0956, 15.98, 15.965, 49100], [0957, 15.98, 15.966, 39737], [0958, 15.96, 15.966, 42600], [0959, 15.97, 15.966, 31100], [1000, 15.97, 15.966, 70600], [1001, 15.96, 15.966, 69300], [1002, 15.94, 15.965, 99763], [1003, 15.94, 15.964, 34600], [1004, 15.94, 15.963, 73300], [1005, 15.94, 15.963, 36000], [1006, 15.93, 15.962, 139600], [1007, 15.92, 15.961, 54600], [1008, 15.9, 15.959, 240500], [1009, 15.89, 15.958, 76100], [1010, 15.89, 15.956, 60700], [1011, 15.9, 15.955, 50800], [1012, 15.91, 15.953, 61900], [1013, 15.92, 15.953, 26500], [1014, 15.91, 15.952, 36000], [1015, 15.91, 15.951, 56700], [1016, 15.91, 15.95, 64300], [1017, 15.89, 15.949, 62800], [1018, 15.9, 15.948, 119500], [1019, 15.9, 15.947, 48900], [1020, 15.92, 15.946, 34600], [1021, 15.92, 15.946, 22200], [1022, 15.93, 15.945, 30800], [1023, 15.92, 15.945, 40800], [1024, 15.9, 15.944, 72300], [1025, 15.9, 15.943, 23000], [1026, 15.92, 15.943, 38000], [1027, 15.94, 15.943, 21500], [1028, 15.94, 15.943, 18100], [1029, 15.93, 15.943, 31000], [1030, 15.93, 15.942, 35600], [1031, 15.92, 15.942, 29900], [1032, 15.92, 15.942, 31500], [1033, 15.93, 15.942, 41500], [1034, 15.94, 15.942, 32300], [1035, 15.94, 15.942, 31000], [1036, 15.94, 15.941, 65400], [1037, 15.93, 15.941, 58100], [1038, 15.92, 15.941, 13647], [1039, 15.93, 15.941, 20000], [1040, 15.93, 15.941, 28800], [1041, 15.93, 15.941, 9700], [1042, 15.94, 15.941, 46100], [1043, 15.93, 15.94, 35400], [1044, 15.95, 15.941, 21563], [1045, 15.98, 15.941, 56400], [1046, 15.99, 15.942, 34000], [1047, 15.96, 15.942, 35900], [1048, 15.97, 15.942, 13600], [1049, 15.97, 15.943, 3600], [1050, 15.98, 15.943, 20700], [1051, 15.98, 15.944, 13000], [1052, 16.0, 15.944, 46368], [1053, 16.03, 15.945, 50800], [1054, 16.03, 15.946, 47600], [1055, 16.03, 15.947, 50200], [1056, 16.02, 15.948, 11404], [1057, 16.04, 15.949, 39959], [1058, 16.06, 15.95, 64800], [1059, 16.04, 15.951, 39700], [1100, 16.03, 15.952, 43541], [1101, 16.02, 15.953, 28600], [1102, 16.02, 15.954, 10596], [1103, 16.0, 15.954, 68500], [1104, 16.08, 15.955, 246204], [1105, 16.05, 15.956, 52600], [1106, 16.04, 15.957, 38600], [1107, 16.04, 15.958, 19700], [1108, 16.03, 15.959, 9800], [1109, 16.05, 15.96, 11600], [1110, 16.04, 15.961, 9800], [1111, 16.04, 15.961, 1500], [1112, 16.04, 15.962, 22700], [1113, 16.04, 15.963, 27600], [1114, 16.03, 15.964, 9500], [1115, 16.05, 15.964, 54400], [1116, 16.06, 15.965, 6500], [1117, 16.05, 15.966, 7800], [1118, 16.05, 15.967, 25700], [1119, 16.04, 15.967, 8300], [1120, 16.04, 15.968, 8800], [1121, 16.07, 15.969, 60700], [1122, 16.07, 15.97, 9600], [1123, 16.07, 15.971, 30000], [1124, 16.07, 15.972, 12700], [1125, 16.06, 15.972, 18700], [1126, 16.08, 15.973, 53800], [1127, 16.07, 15.974, 12900], [1128, 16.08, 15.975, 15400], [1129, 16.08, 15.976, 13500], [1130, 16.08, 15.977, 0], [1300, 16.07, 15.978, 55800], [1301, 16.07, 15.978, 29100], [1302, 16.06, 15.979, 4100], [1303, 16.06, 15.98, 2200], [1304, 16.05, 15.98, 17800], [1305, 16.04, 15.981, 7800], [1306, 16.04, 15.981, 17600], [1307, 16.03, 15.981, 14800], [1308, 16.02, 15.982, 17800], [1309, 16.02, 15.982, 24900], [1310, 16.01, 15.982, 25200], [1311, 16.01, 15.982, 11400], [1312, 16.0, 15.983, 56200], [1313, 16.05, 15.983, 132400], [1314, 16.05, 15.984, 22700], [1315, 16.05, 15.984, 9900], [1316, 16.03, 15.984, 3300], [1317, 16.04, 15.985, 5900], [1318, 16.04, 15.985, 5500], [1319, 16.03, 15.986, 30100], [1320, 16.03, 15.986, 21000], [1321, 16.02, 15.986, 15300], [1322, 16.03, 15.986, 16600], [1323, 16.02, 15.987, 15600], [1324, 16.02, 15.987, 27900], [1325, 16.03, 15.987, 23700], [1326, 16.01, 15.987, 28000], [1327, 16.01, 15.987, 9700], [1328, 16.02, 15.988, 52800], [1329, 16.08, 15.988, 105200], [1330, 16.11, 15.989, 59900], [1331, 16.11, 15.99, 18400], [1332, 16.1, 15.991, 32500], [1333, 16.08, 15.991, 11600], [1334, 16.08, 15.992, 19600], [1335, 16.1, 15.992, 18300], [1336, 16.07, 15.993, 8200], [1337, 16.08, 15.993, 16300], [1338, 16.09, 15.994, 15500], [1339, 16.1, 15.995, 17500], [1340, 16.12, 15.995, 35500], [1341, 16.11, 15.996, 20900], [1342, 16.1, 15.997, 9700], [1343, 16.09, 15.997, 20900], [1344, 16.07, 15.998, 29100], [1345, 16.07, 15.998, 7800], [1346, 16.06, 15.999, 32500], [1347, 16.05, 15.999, 8500], [1348, 16.06, 15.999, 13800], [1349, 16.04, 16.0, 30400], [1350, 16.03, 16.0, 13300], [1351, 16.02, 16.0, 23700], [1352, 16.01, 16.0, 31200], [1353, 16.01, 16.0, 16100], [1354, 16.01, 16.0, 26500], [1355, 16.02, 16.0, 65600], [1356, 16.01, 16.0, 40300], [1357, 16.02, 16.0, 2600], [1358, 16.03, 16.0, 13700], [1359, 16.03, 16.001, 15600], [1400, 16.03, 16.001, 12800], [1401, 16.03, 16.001, 27600], [1402, 16.02, 16.001, 23200], [1403, 16.04, 16.001, 21100], [1404, 16.04, 16.001, 7500], [1405, 16.04, 16.002, 9800], [1406, 16.04, 16.002, 16000], [1407, 16.04, 16.002, 49700], [1408, 16.03, 16.002, 3900], [1409, 16.03, 16.002, 10700], [1410, 16.03, 16.003, 25200], [1411, 16.02, 16.003, 6400], [1412, 16.02, 16.003, 120000], [1413, 16.0, 16.003, 9300], [1414, 15.99, 16.003, 51700], [1415, 15.99, 16.003, 23300], [1416, 15.99, 16.002, 62600], [1417, 15.97, 16.002, 21700], [1418, 15.98, 16.002, 24800], [1419, 15.98, 16.002, 14000], [1420, 15.98, 16.002, 25700], [1421, 15.98, 16.002, 26800], [1422, 15.99, 16.002, 32500], [1423, 15.99, 16.002, 13900], [1424, 15.99, 16.002, 17600], [1425, 15.98, 16.002, 25700], [1426, 15.98, 16.001, 55600], [1427, 15.97, 16.001, 22900], [1428, 15.97, 16.001, 36400], [1429, 15.98, 16.001, 59900], [1430, 15.98, 16.001, 19800], [1431, 16.0, 16.001, 38100], [1432, 15.99, 16.001, 14500], [1433, 16.01, 16.001, 11700], [1434, 16.01, 16.001, 14000], [1435, 16.02, 16.001, 3300], [1436, 16.01, 16.001, 16600], [1437, 16.01, 16.001, 18000], [1438, 16.02, 16.001, 21500], [1439, 16.01, 16.001, 27100], [1440, 16.02, 16.001, 31500], [1441, 16.02, 16.001, 20200], [1442, 16.02, 16.002, 20100], [1443, 16.02, 16.002, 39400], [1444, 16.0, 16.002, 201218], [1445, 16.01, 16.002, 12400], [1446, 16.01, 16.002, 39300], [1447, 16.0, 16.002, 28182], [1448, 15.99, 16.002, 41000], [1449, 16.0, 16.002, 65700], [1450, 16.0, 16.002, 45100], [1451, 16.0, 16.002, 106500], [1452, 16.02, 16.002, 73100], [1453, 16.01, 16.002, 42200], [1454, 16.0, 16.002, 76700], [1455, 16.01, 16.002, 79698], [1456, 16.01, 16.002, 125600], [1457, 16.01, 16.002, 100], [1458, 16.01, 16.002, 0], [1459, 16.01, 16.002, 0], [1500, 16.01, 16.002, 88600]],
         *      yestclose=16.44,
         *      lastVolume=12114280,
         *      date=20190826},
         *      {count=242, data=[[0930, 16.69, 16.69, 39100], [0931, 16.61, 16.65, 340200], [0932, 16.61, 16.637, 91700], [0933, 16.6, 16.627, 115300], [0934, 16.42, 16.586, 242500], [0935, 16.42, 16.558, 458700], [0936, 16.47, 16.546, 128700], [0937, 16.47, 16.536, 123800], [0938, 16.52, 16.534, 49955], [0939, 16.49, 16.53, 156300], [0940, 16.49, 16.526, 142001], [0941, 16.5, 16.524, 58300], [0942, 16.5, 16.522, 107000], [0943, 16.51, 16.521, 128200], [0944, 16.48, 16.519, 113999], [0945, 16.48, 16.516, 79045], [0946, 16.47, 16.514, 68900], [0947, 16.47, 16.511, 108800], [0948, 16.45, 16.508, 104900], [0949, 16.45, 16.505, 73000], [0950, 16.47, 16.503, 36400], [0951, 16.46, 16.501, 68000], [0952, 16.47, 16.5, 59500], [0953, 16.5, 16.5, 67490], [0954, 16.6, 16.504, 77910], [0955, 16.69, 16.511, 187500], [0956, 16.73, 16.519, 285600], [0957, 16.72, 16.526, 283700], [0958, 16.75, 16.534, 237200], [0959, 16.84, 16.544, 338935], [1000, 16.73, 16.55, 359865], [1001, 16.75, 16.557, 188200], [1002, 16.71, 16.561, 230400], [1003, 16.68, 16.565, 167400], [1004, 16.69, 16.568, 41800], [1005, 16.59, 16.569, 194800], [1006, 16.63, 16.571, 107600], [1007, 16.61, 16.572, 43600], [1008, 16.62, 16.573, 39400], [1009, 16.62, 16.574, 75100], [1010, 16.66, 16.576, 28000], [1011, 16.58, 16.576, 119200], [1012, 16.58, 16.576, 50900], [1013, 16.62, 16.577, 12100], [1014, 16.62, 16.578, 54400], [1015, 16.55, 16.578, 169400], [1016, 16.55, 16.577, 19100], [1017, 16.55, 16.576, 37100], [1018, 16.54, 16.576, 60200], [1019, 16.53, 16.575, 36000], [1020, 16.51, 16.574, 83400], [1021, 16.53, 16.573, 25900], [1022, 16.53, 16.572, 21000], [1023, 16.54, 16.571, 52900], [1024, 16.58, 16.571, 30500], [1025, 16.57, 16.571, 24800], [1026, 16.56, 16.571, 7400], [1027, 16.55, 16.571, 15500], [1028, 16.59, 16.571, 17500], [1029, 16.56, 16.571, 36300], [1030, 16.6, 16.571, 8800], [1031, 16.61, 16.572, 21400], [1032, 16.59, 16.572, 4900], [1033, 16.6, 16.573, 20700], [1034, 16.58, 16.573, 11200], [1035, 16.58, 16.573, 24000], [1036, 16.59, 16.573, 27700], [1037, 16.59, 16.574, 13600], [1038, 16.61, 16.574, 8500], [1039, 16.63, 16.575, 25600], [1040, 16.64, 16.576, 53100], [1041, 16.63, 16.577, 43000], [1042, 16.58, 16.577, 65300], [1043, 16.57, 16.576, 80400], [1044, 16.58, 16.577, 6100], [1045, 16.56, 16.576, 29400], [1046, 16.55, 16.576, 44600], [1047, 16.56, 16.576, 9200], [1048, 16.52, 16.575, 94400], [1049, 16.52, 16.574, 38900], [1050, 16.53, 16.574, 19000], [1051, 16.52, 16.573, 9900], [1052, 16.54, 16.573, 46300], [1053, 16.54, 16.572, 8700], [1054, 16.54, 16.572, 8800], [1055, 16.54, 16.572, 7500], [1056, 16.55, 16.571, 15000], [1057, 16.57, 16.571, 4700], [1058, 16.54, 16.571, 24531], [1059, 16.55, 16.571, 8300], [1100, 16.53, 16.57, 64900], [1101, 16.54, 16.57, 5800], [1102, 16.54, 16.57, 15900], [1103, 16.53, 16.569, 7500], [1104, 16.57, 16.569, 23400], [1105, 16.57, 16.569, 2800], [1106, 16.54, 16.569, 8500], [1107, 16.54, 16.569, 13600], [1108, 16.5, 16.568, 239200], [1109, 16.51, 16.567, 46171], [1110, 16.51, 16.567, 95900], [1111, 16.53, 16.566, 27900], [1112, 16.54, 16.566, 56800], [1113, 16.54, 16.566, 12800], [1114, 16.52, 16.566, 30700], [1115, 16.51, 16.565, 16700], [1116, 16.51, 16.564, 13800], [1117, 16.49, 16.564, 92500], [1118, 16.49, 16.563, 49900], [1119, 16.49, 16.562, 116629], [1120, 16.48, 16.562, 28000], [1121, 16.49, 16.561, 49000], [1122, 16.48, 16.56, 18300], [1123, 16.49, 16.56, 17900], [1124, 16.48, 16.559, 5513], [1125, 16.48, 16.558, 94500], [1126, 16.47, 16.558, 67100], [1127, 16.45, 16.557, 68071], [1128, 16.46, 16.556, 46600], [1129, 16.48, 16.555, 152700], [1130, 16.48, 16.555, 1100], [1300, 16.5, 16.554, 245000], [1301, 16.5, 16.554, 1700], [1302, 16.48, 16.553, 6400], [1303, 16.5, 16.553, 7000], [1304, 16.52, 16.552, 10300], [1305, 16.5, 16.552, 2500], [1306, 16.52, 16.552, 16100], [1307, 16.52, 16.552, 3300], [1308, 16.51, 16.551, 3900], [1309, 16.51, 16.551, 6400], [1310, 16.53, 16.551, 46100], [1311, 16.52, 16.551, 13400], [1312, 16.51, 16.55, 28600], [1313, 16.5, 16.55, 25200], [1314, 16.5, 16.549, 8800], [1315, 16.49, 16.549, 26100], [1316, 16.48, 16.549, 13700], [1317, 16.5, 16.548, 20000], [1318, 16.48, 16.548, 35300], [1319, 16.47, 16.547, 11000], [1320, 16.46, 16.547, 22900], [1321, 16.46, 16.546, 10300], [1322, 16.45, 16.545, 35800], [1323, 16.47, 16.545, 15600], [1324, 16.46, 16.544, 29100], [1325, 16.45, 16.544, 20500], [1326, 16.44, 16.543, 24000], [1327, 16.44, 16.542, 37300], [1328, 16.45, 16.542, 9400], [1329, 16.46, 16.541, 16400], [1330, 16.44, 16.54, 8700], [1331, 16.44, 16.54, 25500], [1332, 16.44, 16.539, 32900], [1333, 16.42, 16.538, 42800], [1334, 16.42, 16.537, 42800], [1335, 16.42, 16.537, 26600], [1336, 16.41, 16.536, 86200], [1337, 16.41, 16.535, 26400], [1338, 16.42, 16.534, 32500], [1339, 16.42, 16.534, 24900], [1340, 16.42, 16.533, 36500], [1341, 16.42, 16.532, 26300], [1342, 16.42, 16.532, 38200], [1343, 16.41, 16.531, 135400], [1344, 16.41, 16.53, 18700], [1345, 16.42, 16.53, 15800], [1346, 16.43, 16.529, 13500], [1347, 16.42, 16.528, 22000], [1348, 16.42, 16.528, 15700], [1349, 16.42, 16.527, 13500], [1350, 16.41, 16.526, 55700], [1351, 16.42, 16.526, 17000], [1352, 16.42, 16.525, 18100], [1353, 16.42, 16.525, 39400], [1354, 16.42, 16.524, 39000], [1355, 16.43, 16.523, 22400], [1356, 16.42, 16.523, 48200], [1357, 16.37, 16.522, 387500], [1358, 16.4, 16.521, 22500], [1359, 16.4, 16.521, 28800], [1400, 16.41, 16.52, 34300], [1401, 16.4, 16.519, 8200], [1402, 16.39, 16.519, 73300], [1403, 16.4, 16.518, 45900], [1404, 16.39, 16.517, 18500], [1405, 16.4, 16.517, 23600], [1406, 16.41, 16.516, 20200], [1407, 16.4, 16.516, 41700], [1408, 16.42, 16.515, 25400], [1409, 16.41, 16.514, 8300], [1410, 16.41, 16.514, 49200], [1411, 16.41, 16.513, 42900], [1412, 16.41, 16.513, 20700], [1413, 16.42, 16.512, 30400], [1414, 16.44, 16.512, 45200], [1415, 16.43, 16.512, 32000], [1416, 16.44, 16.511, 19000], [1417, 16.44, 16.511, 49300], [1418, 16.45, 16.511, 21800], [1419, 16.47, 16.51, 35000], [1420, 16.48, 16.51, 22200], [1421, 16.51, 16.51, 22100], [1422, 16.49, 16.51, 55100], [1423, 16.51, 16.51, 11100], [1424, 16.5, 16.51, 18000], [1425, 16.49, 16.51, 45700], [1426, 16.46, 16.51, 51200], [1427, 16.47, 16.51, 10300], [1428, 16.47, 16.509, 12610], [1429, 16.48, 16.509, 16400], [1430, 16.48, 16.509, 33300], [1431, 16.49, 16.509, 44700], [1432, 16.49, 16.509, 10600], [1433, 16.49, 16.509, 32500], [1434, 16.51, 16.509, 20100], [1435, 16.49, 16.509, 42800], [1436, 16.5, 16.509, 8600], [1437, 16.5, 16.509, 45300], [1438, 16.49, 16.509, 29200], [1439, 16.49, 16.508, 30200], [1440, 16.49, 16.508, 88100], [1441, 16.45, 16.508, 25900], [1442, 16.46, 16.508, 29900], [1443, 16.45, 16.508, 94600], [1444, 16.45, 16.507, 155700], [1445, 16.44, 16.507, 14600], [1446, 16.44, 16.507, 32800], [1447, 16.44, 16.507, 21600], [1448, 16.44, 16.506, 40700], [1449, 16.44, 16.506, 159200], [1450, 16.42, 16.506, 25200], [1451, 16.43, 16.505, 75500], [1452, 16.41, 16.505, 89200], [1453, 16.42, 16.504, 31800], [1454, 16.42, 16.504, 58500], [1455, 16.42, 16.504, 103100], [1456, 16.44, 16.503, 98700], [1457, 16.44, 16.503, 8200], [1458, 16.44, 16.503, 0], [1459, 16.44, 16.503, 0], [1500, 16.44, 16.502, 115500]],
         *      yestclose=16.63,
         *      lastVolume=13587425,
         *      date=20190823},
         *      {count=242, data=[[0930, 17.13, 17.13, 170700], [0931, 17.02, 17.075, 802554], [0932, 16.81, 16.987, 233381], [0933, 16.91, 16.967, 347100], [0934, 16.85, 16.944, 412404], [0935, 16.91, 16.938, 153700], [0936, 16.82, 16.921, 278096], [0937, 16.84, 16.911, 229900], [0938, 16.91, 16.911, 138904], [0939, 16.93, 16.913, 108100], [0940, 16.87, 16.909, 173200], [0941, 16.86, 16.905, 206400], [0942, 16.88, 16.903, 136600], [0943, 16.84, 16.899, 94500], [0944, 16.82, 16.893, 223700], [0945, 16.7, 16.881, 411419], [0946, 16.71, 16.871, 519600], [0947, 16.74, 16.864, 230781], [0948, 16.68, 16.854, 261300], [0949, 16.67, 16.845, 435600], [0950, 16.74, 16.84, 348900], [0951, 16.73, 16.835, 170606], [0952, 16.78, 16.833, 174194], [0953, 16.8, 16.831, 145900], [0954, 16.76, 16.828, 75900], [0955, 16.72, 16.824, 123700], [0956, 16.73, 16.821, 161200], [0957, 16.68, 16.816, 111500], [0958, 16.73, 16.813, 201500], [0959, 16.74, 16.81, 111500], [1000, 16.8, 16.81, 146000], [1001, 16.79, 16.809, 174200], [1002, 16.76, 16.808, 53500], [1003, 16.77, 16.807, 41200], [1004, 16.74, 16.805, 91700], [1005, 16.78, 16.804, 245200], [1006, 16.82, 16.805, 81500], [1007, 16.8, 16.804, 206000], [1008, 16.79, 16.804, 66200], [1009, 16.78, 16.804, 53400], [1010, 16.79, 16.803, 72700], [1011, 16.77, 16.802, 79085], [1012, 16.75, 16.801, 66615], [1013, 16.72, 16.799, 35300], [1014, 16.72, 16.798, 71600], [1015, 16.73, 16.796, 84900], [1016, 16.76, 16.795, 71200], [1017, 16.73, 16.794, 100000], [1018, 16.72, 16.792, 56900], [1019, 16.71, 16.791, 58500], [1020, 16.73, 16.79, 61100], [1021, 16.75, 16.789, 43100], [1022, 16.78, 16.789, 71900], [1023, 16.78, 16.789, 59000], [1024, 16.74, 16.788, 43300], [1025, 16.74, 16.787, 87300], [1026, 16.74, 16.786, 96000], [1027, 16.74, 16.785, 86500], [1028, 16.73, 16.784, 37500], [1029, 16.72, 16.783, 40100], [1030, 16.73, 16.782, 93500], [1031, 16.71, 16.781, 64200], [1032, 16.72, 16.78, 35400], [1033, 16.73, 16.779, 49300], [1034, 16.72, 16.778, 55100], [1035, 16.72, 16.778, 23100], [1036, 16.71, 16.777, 54900], [1037, 16.71, 16.776, 24500], [1038, 16.71, 16.775, 56700], [1039, 16.7, 16.774, 80800], [1040, 16.69, 16.772, 103600], [1041, 16.66, 16.771, 136200], [1042, 16.67, 16.769, 93600], [1043, 16.69, 16.768, 43000], [1044, 16.69, 16.767, 44293], [1045, 16.69, 16.766, 37500], [1046, 16.69, 16.765, 66359], [1047, 16.67, 16.764, 94648], [1048, 16.64, 16.763, 115800], [1049, 16.64, 16.761, 76100], [1050, 16.65, 16.76, 171700], [1051, 16.64, 16.758, 53700], [1052, 16.64, 16.757, 76200], [1053, 16.67, 16.756, 56500], [1054, 16.68, 16.755, 22100], [1055, 16.69, 16.754, 46100], [1056, 16.68, 16.753, 29800], [1057, 16.66, 16.752, 38100], [1058, 16.65, 16.751, 29500], [1059, 16.65, 16.75, 28600], [1100, 16.65, 16.749, 33500], [1101, 16.65, 16.748, 36200], [1102, 16.65, 16.747, 16700], [1103, 16.65, 16.746, 19800], [1104, 16.65, 16.745, 33600], [1105, 16.66, 16.744, 55100], [1106, 16.67, 16.743, 11900], [1107, 16.66, 16.742, 20700], [1108, 16.66, 16.741, 37100], [1109, 16.66, 16.741, 25600], [1110, 16.66, 16.74, 15200], [1111, 16.67, 16.739, 29600], [1112, 16.69, 16.739, 16700], [1113, 16.69, 16.738, 18500], [1114, 16.68, 16.738, 14800], [1115, 16.69, 16.737, 7000], [1116, 16.69, 16.737, 13200], [1117, 16.68, 16.736, 27400], [1118, 16.68, 16.736, 8700], [1119, 16.67, 16.735, 15000], [1120, 16.66, 16.734, 11300], [1121, 16.67, 16.734, 16000], [1122, 16.65, 16.733, 13000], [1123, 16.65, 16.732, 17300], [1124, 16.66, 16.732, 20200], [1125, 16.66, 16.731, 17600], [1126, 16.65, 16.73, 17400], [1127, 16.66, 16.73, 33800], [1128, 16.65, 16.729, 8300], [1129, 16.66, 16.729, 20400], [1130, 16.66, 16.728, 0], [1300, 16.67, 16.727, 75500], [1301, 16.68, 16.727, 2600], [1302, 16.67, 16.727, 4400], [1303, 16.67, 16.726, 24500], [1304, 16.68, 16.726, 24200], [1305, 16.69, 16.726, 17800], [1306, 16.69, 16.725, 19900], [1307, 16.7, 16.725, 46100], [1308, 16.68, 16.725, 9900], [1309, 16.68, 16.724, 9600], [1310, 16.67, 16.724, 21300], [1311, 16.67, 16.724, 29000], [1312, 16.66, 16.723, 11100], [1313, 16.65, 16.723, 17900], [1314, 16.64, 16.722, 117100], [1315, 16.64, 16.721, 119500], [1316, 16.63, 16.721, 48300], [1317, 16.62, 16.72, 44700], [1318, 16.59, 16.719, 443900], [1319, 16.58, 16.718, 105300], [1320, 16.58, 16.717, 133600], [1321, 16.58, 16.716, 32300], [1322, 16.57, 16.715, 63100], [1323, 16.58, 16.714, 41100], [1324, 16.6, 16.713, 16400], [1325, 16.58, 16.712, 19400], [1326, 16.58, 16.712, 35100], [1327, 16.57, 16.711, 69000], [1328, 16.57, 16.71, 28300], [1329, 16.55, 16.709, 100900], [1330, 16.56, 16.708, 46400], [1331, 16.57, 16.707, 56047], [1332, 16.57, 16.706, 83900], [1333, 16.58, 16.705, 130900], [1334, 16.57, 16.704, 98300], [1335, 16.58, 16.703, 36800], [1336, 16.59, 16.703, 45700], [1337, 16.59, 16.702, 38600], [1338, 16.58, 16.701, 15000], [1339, 16.57, 16.7, 54800], [1340, 16.58, 16.7, 29900], [1341, 16.58, 16.699, 34300], [1342, 16.58, 16.698, 34500], [1343, 16.59, 16.698, 35200], [1344, 16.57, 16.697, 20200], [1345, 16.59, 16.696, 38800], [1346, 16.59, 16.695, 48200], [1347, 16.61, 16.695, 38600], [1348, 16.62, 16.695, 32400], [1349, 16.61, 16.694, 51100], [1350, 16.58, 16.693, 85800], [1351, 16.6, 16.693, 20500], [1352, 16.59, 16.692, 71200], [1353, 16.59, 16.692, 19300], [1354, 16.57, 16.691, 29600], [1355, 16.56, 16.69, 63300], [1356, 16.56, 16.689, 38100], [1357, 16.57, 16.689, 33300], [1358, 16.57, 16.688, 16100], [1359, 16.57, 16.688, 71500], [1400, 16.59, 16.687, 124100], [1401, 16.62, 16.687, 50900], [1402, 16.62, 16.686, 27100], [1403, 16.62, 16.686, 33400], [1404, 16.6, 16.685, 57600], [1405, 16.6, 16.685, 34100], [1406, 16.62, 16.685, 24500], [1407, 16.61, 16.684, 24600], [1408, 16.61, 16.684, 22152], [1409, 16.62, 16.684, 17100], [1410, 16.62, 16.683, 30100], [1411, 16.62, 16.683, 25300], [1412, 16.64, 16.683, 25746], [1413, 16.65, 16.682, 25900], [1414, 16.65, 16.682, 41100], [1415, 16.66, 16.682, 82100], [1416, 16.66, 16.682, 29000], [1417, 16.66, 16.682, 27000], [1418, 16.68, 16.682, 20800], [1419, 16.68, 16.682, 71800], [1420, 16.69, 16.682, 33100], [1421, 16.66, 16.682, 61100], [1422, 16.66, 16.682, 24900], [1423, 16.67, 16.682, 31400], [1424, 16.64, 16.682, 71000], [1425, 16.66, 16.681, 26300], [1426, 16.64, 16.681, 47900], [1427, 16.64, 16.681, 25000], [1428, 16.64, 16.681, 14400], [1429, 16.61, 16.68, 82200], [1430, 16.62, 16.68, 16200], [1431, 16.6, 16.68, 66900], [1432, 16.6, 16.679, 109500], [1433, 16.61, 16.679, 65600], [1434, 16.61, 16.679, 21500], [1435, 16.6, 16.678, 118900], [1436, 16.61, 16.678, 51500], [1437, 16.61, 16.678, 30800], [1438, 16.61, 16.678, 92800], [1439, 16.61, 16.677, 36800], [1440, 16.62, 16.677, 39959], [1441, 16.62, 16.677, 29700], [1442, 16.63, 16.676, 31000], [1443, 16.62, 16.676, 115700], [1444, 16.61, 16.676, 69041], [1445, 16.61, 16.676, 105800], [1446, 16.6, 16.675, 119859], [1447, 16.6, 16.675, 80300], [1448, 16.61, 16.675, 139300], [1449, 16.61, 16.674, 103400], [1450, 16.61, 16.674, 77200], [1451, 16.61, 16.674, 123100], [1452, 16.61, 16.674, 87900], [1453, 16.62, 16.673, 83400], [1454, 16.61, 16.673, 119300], [1455, 16.62, 16.673, 46900], [1456, 16.62, 16.673, 90700], [1457, 16.63, 16.672, 10000], [1458, 16.63, 16.672, 0], [1459, 16.63, 16.672, 0], [1500, 16.63, 16.672, 139200]],
         *      yestclose=16.98,
         *      lastVolume=18790943,
         *      date=20190822}],
         *      name=张江高科}
         */
        try {
            String symbol = (String) data.get("symbol");
            String name = (String) data.get("name");
            List<HashMap> detail = (List<HashMap>)data.get("data");
            return detail.stream().map( i -> {
                i.put("symbol", symbol);
                i.put("name", name);
                return i;
            }).collect(Collectors.toList());
        } catch (Exception e) {
            e.printStackTrace();
        }
        return Collections.EMPTY_LIST;
    }


    public static void main(String[] args) {
     log.error("result is:{}", format(9.2352312312312D));
    }

}
